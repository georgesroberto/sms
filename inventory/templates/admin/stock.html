{% extends 'base.html' %} {% block content %}

<section class="py-4">
  <div class="container-fluid">
    <!-- Title -->
    <div class="row mb-3 align-items-center">
      <div class="col-md-6">
        <h2 class="h4 mb-0">Products Inventory</h2>
      </div>
      <div class="col-md-6 text-md-end">
        <!-- Buttons trigger modals -->
        <button
          class="btn btn-primary btn-sm"
          data-bs-toggle="modal"
          data-bs-target="#addProductModal"
        >
          + Add Product
        </button>
        <button
          class="btn btn-success btn-sm"
          data-bs-toggle="modal"
          data-bs-target="#addStockModal"
        >
          + Add Stock
        </button>
      </div>
    </div>

    <!-- Product Table -->
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <p class="text-muted small mb-3">
          All products with current stock levels and pricing.
        </p>
        <div class="table-responsive">
          <table class="table table-striped table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>Product</th>
                <th>Category</th>
                <th>Stock Qty</th>
                <th>Cost Price</th>
                <th>Selling Price</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for product in products %}
              <tr>
                <td>{{ product.name }}</td>
                <td>{{ product.category.name }}</td>
                <td>{{ product.quantity }}</td>
                <td>{{ product.buying_price }}</td>
                <td>{{ product.selling_price }}</td>
                <td>
                  {% if product.needs_restock %}
                  <span class="badge bg-danger">Reorder</span>
                  {% else %}
                  <span class="badge bg-success">In Stock</span>
                  {% endif %}
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="6" class="text-center text-muted">
                  No products available.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Stock Entries Table -->
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Stock Entries</h5>
        <p class="text-muted small mb-3">History of all stock additions.</p>
        <div class="table-responsive">
          <table class="table table-striped table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>Date Added</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Cost Price</th>
                <th>Added By</th>
              </tr>
            </thead>
            <tbody>
              {% for entry in stock_entries %}
              <tr>
                <td>{{ entry.date_added|date:"Y-m-d H:i" }}</td>
                <td>{{ entry.product.name }}</td>
                <td>{{ entry.quantity }}</td>
                <td>{{ entry.buying_price }}</td>
                <td>{{ entry.added_by|default:"-" }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center text-muted">
                  No stock entries recorded yet.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Modal: Add Product -->
<div
  class="modal fade"
  id="addProductModal"
  tabindex="-1"
  aria-labelledby="addProductLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <form method="post" class="modal-content">
      {% csrf_token %}
      <div class="modal-header">
        <h5 class="modal-title" id="addProductLabel">Add New Product</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body">{{ form.as_p }}</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button type="submit" name="create_product" class="btn btn-primary">
          Save Product
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Add Stock -->
<div
  class="modal fade"
  id="addStockModal"
  tabindex="-1"
  aria-labelledby="addStockLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <form method="post" class="modal-content">
      {% csrf_token %}
      <div class="modal-header">
        <h5 class="modal-title" id="addStockLabel">Add Stock Entry</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body">{{ stock_form.as_p }}</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button type="submit" name="add_stock" class="btn btn-success">
          Save Stock
        </button>
      </div>
    </form>
  </div>
</div>

{% endblock %}
